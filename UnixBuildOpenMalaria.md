# Building OpenMalaria #

This page gives a brief idea of how to compile **OpenMalaria** on a Unix or Linux machine. This has been tested on Ubuntu 12.04, you may have to adapt specific steps (e.g. installing dependencies) depending on your distribution.

## Dependencies ##

**OpenMalaria** has the usual dependencies. Most of these packages are distributed with your linux distribution and only need to be installed.

  * Python 2.6 or 2.7 (not 3.x)

  * C++ compiler (GCC or Clang). We use the older C++98 standard to maintain compatibility with older compilers.

  * CMake (recommended: the Qt-based cmake-gui or ccmake)

  * Java - you'll need Java to run the experiment builder tool and schema translator; both [OpenJDK](http://openjdk.java.net/) and [Sun/Oracle Java](http://java.com/en/) should work

  * gsl − If not included in your linux distribution, install from [libgsl0-dev](http://packages.debian.org/search?keywords=libgsl0-dev). For older linux distributions, please check that you are using gsl version >= 13, otherwise some black box tests might fail.

  * libboost1.42 or later

  * [UnixBuildXercesC](UnixBuildXercesC.md) [libxerces-c2-dev](http://packages.debian.org/search?keywords=libxerces-c2-dev)

  * XSD (from Code Synthesis; often called xsdcxx) − Install the [xsdcxx](http://packages.debian.org/search?keywords=xsdcxx) package or manually compile and install from: http://codesynthesis.com/products/xsd/download.xhtml

  * [zlib1g-dev](http://packages.debian.org/search?keywords=zlib1g-dev)

If you would like to donate your otherwise dormant cpu cycles to the project via BOINC, also add

  * [UnixBuildBoinc](UnixBuildBoinc.md) [boinc-dev](http://packages.debian.org/search?keywords=boinc-dev)

The OpenMalaria source code is stored in a source-safed repository that is managed with [subversion](http://subversion.apache.org/packages.html). Technically, you don't need to have subversion installed to check out the source code, but it makes things simpler if you do. In any case, the code repository can be access via several command line or GUI or IDE tools.

## Download OpenMalaria source code ##
Once the dependencies are installed, you are ready to download the source code. For this and the following steps, we assume you have set up a working directory (e.g. /home/yourname/workspace). We will refer to this as WORKSPACE from now.

First, [check out the source code from the repository](http://code.google.com/p/openmalaria/source/checkout) and `cd` to the checkout directory, which should be WORKSPACE/openmalaria/.

To keep the generated files out of the way of the source code, its best to create a separate build directory under the source code directory:

```
mkdir build
cd build
```

The build directory (WORKSPACE/openmalaria/build/ ) will initially be empty - the next task is to **configure** the makefiles that will be used to compile and link the source code and libraries. Configuration is a two step process.

## Configure the build environment ##

First run the configuration program to create the makefiles; then re-run the configuation step to set the options in those makefiles.

Run cmake, passing the path of the **OpenMalaria** directory you checked out:
```
cmake-gui ..
# You can use *ccmake* or just *cmake* instead of *cmake-gui*
```

The configured makefiles will appear in the build directory.  Now, you can select or adjust options and then rerun the configuration step. Most options were already listed in the main [build page](BuildSystem.md), however a brief reminder:
Options you may want to change (e.g., to create a version to deploy as a BOINC binary):

| option | |
|:-------|:|
| CMAKE\_BUILD\_TYPE | You probably should change this;  RelWithDebInfo works well |
| BOINC\_INTEGRATION | Enables BOINC. Defaults to off. |
| STATICALLY\_LINK | Try linking everything statically instead of dynamically. Don't use unless you know you want it. |
| CMAKE\_VERBOSE\_MAKEFILE | If you're having trouble building and want to tweak the linker command, you'll need more detail in the makefile |

Now you should be ready to build.

## Compile OpenMalaria ##

> Depending on which build-tool you've selected (cmake will ask which tool when configuring on an empty build directory), you can run `make`, or you can open the project/solution file generated by cmake in the build directory. If you are using the cmake-gui, you can simply hit the generate button to create the executable binary.

### Static build [developer specifications ](.md) ###

There are a few subtleties with the static build. First,  you'll need to compile the static Xerces library from source on your machine in order to avoid mutex errors. When compiling Xerces, you'll need to inform the linker to build the static version with the **-static-libgcc** argument.

Be aware that checking the **STATICALLY\_LINK** option doesn't ensure you that the gsl and xerces static libraries will be used. The system cheerfully ignore your selection of this option and automatically take the dynamic library version. You'll have to force the system to use the static libraries by explicitly giving their paths (in most cases /usr/local/lib or /usr/lib) .

The configure command for xerces for instance,  would be similar to either of these two examples:

Building Xerces-c 3.1.1:
./configure --disable-shared --disable-network LDFLAGS=-static-libgcc

Once these configuration issues are sorted, you should be able to build a proper static  version of **OpenMalaria**. Again, during the **OpenMalaria** building process  pass the arguments **-static-libgcc -Wl,-Bstatic -lstdc++**  to ensure that the correct, static version of these libraries is linked. After having compiled the binaries, you can check that the correct dependencies have been installed  with `ldd`.